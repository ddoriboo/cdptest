<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CDP AI ÏûêÏó∞Ïñ¥ ÏøºÎ¶¨ ÌîåÎû´Ìèº</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .query-section {
            padding: 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }
        
        .query-input-container {
            position: relative;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .query-input {
            width: 100%;
            padding: 20px 60px 20px 20px;
            font-size: 18px;
            border: 2px solid #e9ecef;
            border-radius: 25px;
            outline: none;
            transition: border-color 0.3s ease;
            background: white;
        }
        
        .query-input:focus {
            border-color: #4CAF50;
        }
        
        .query-input::placeholder {
            color: #6c757d;
        }
        
        .query-button {
            position: absolute;
            right: 5px;
            top: 50%;
            transform: translateY(-50%);
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            border: none;
            padding: 15px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .query-button:hover {
            transform: translateY(-50%) scale(1.05);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
        }
        
        .query-examples {
            margin-top: 20px;
            text-align: center;
        }
        
        .example-tag {
            display: inline-block;
            background: white;
            color: #495057;
            padding: 8px 15px;
            margin: 5px;
            border-radius: 20px;
            border: 1px solid #dee2e6;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }
        
        .example-tag:hover {
            background: #4CAF50;
            color: white;
            transform: translateY(-2px);
        }
        
        .results-container {
            padding: 30px;
            display: none;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            display: none;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4CAF50;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .analysis-result {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            border-left: 5px solid #4CAF50;
        }
        
        .analysis-title {
            font-size: 1.4em;
            color: #2c3e50;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        
        .analysis-title::before {
            content: "üéØ";
            margin-right: 10px;
        }
        
        .column-recommendations {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .column-group {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #e9ecef;
        }
        
        .column-group h4 {
            color: #495057;
            margin-bottom: 15px;
            font-size: 1.1em;
            display: flex;
            align-items: center;
        }
        
        .column-item {
            background: #f8f9fa;
            padding: 10px 15px;
            margin: 8px 0;
            border-radius: 8px;
            border-left: 3px solid #4CAF50;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .column-name {
            font-weight: 500;
            color: #2c3e50;
        }
        
        .column-score {
            background: #4CAF50;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .reasoning-section {
            background: linear-gradient(135deg, #ff7e5f 0%, #feb47b 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
        }
        
        .reasoning-section h4 {
            margin-bottom: 15px;
            font-size: 1.2em;
        }
        
        .reasoning-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 12px 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 3px solid rgba(255, 255, 255, 0.3);
        }
        
        .sql-section {
            background: #2c3e50;
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
        }
        
        .sql-section h4 {
            margin-bottom: 15px;
            color: #ecf0f1;
        }
        
        .sql-query {
            background: #34495e;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
            white-space: pre-wrap;
        }
        
        .copy-button {
            background: #3498db;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
            font-size: 12px;
        }
        
        .stats-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }
        
        .export-section {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .export-button {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            margin: 0 10px;
            transition: all 0.3s ease;
        }
        
        .export-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.3);
        }
        
        @media (max-width: 768px) {
            .column-recommendations {
                grid-template-columns: 1fr;
            }
            
            .stats-section {
                grid-template-columns: 1fr;
            }
            
            .query-input {
                font-size: 16px;
                padding: 15px 50px 15px 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ñ CDP AI ÏûêÏó∞Ïñ¥ ÏøºÎ¶¨ ÌîåÎû´Ìèº</h1>
            <p>ÏûêÏó∞Ïñ¥Î°ú ÏßàÎ¨∏ÌïòÎ©¥ AIÍ∞Ä ÏµúÏ†ÅÏùò Í≥†Í∞ù ÏÑ∏Í∑∏Î®ºÌÖåÏù¥ÏÖò Ï†ÑÎûµÏùÑ Ï∂îÏ≤úÌï©ÎãàÎã§</p>
        </div>
        
        <div class="query-section">
            <div class="query-input-container">
                <input type="text" 
                       class="query-input" 
                       id="queryInput" 
                       placeholder="Ïòà: ÎåÄÏ∂ú ÎãàÏ¶àÍ∞Ä ÎÜíÏùÄ Í≥†Í∞ùÍµ∞ ÏïåÎ†§Ï§ò, Ï†äÏùÄ Ïó¨ÏÑ± Ï§ë Î∑∞Ìã∞ Í¥ÄÏã¨ÏÇ¨Í∞Ä ÎÜíÏùÄ Í≥†Í∞ù Ï∞æÏïÑÏ§ò"
                       onkeypress="handleKeyPress(event)">
                <button class="query-button" onclick="processQuery()">
                    üîç Î∂ÑÏÑù
                </button>
            </div>
            
            <div class="query-examples">
                <div class="example-tag" onclick="setExampleQuery('ÎåÄÏ∂ú ÎãàÏ¶àÍ∞Ä ÎÜíÏùÄ Í≥†Í∞ùÍµ∞ ÏïåÎ†§Ï§ò')">
                    üí∞ ÎåÄÏ∂ú ÎãàÏ¶à Í≥†Í∞ù
                </div>
                <div class="example-tag" onclick="setExampleQuery('20-30ÎåÄ Ïó¨ÏÑ± Ï§ë Î∑∞Ìã∞Ïóê Í¥ÄÏã¨Ïù¥ ÎßéÏùÄ Í≥†Í∞ù')">
                    üíÑ Î∑∞Ìã∞ Í¥ÄÏã¨ Ïó¨ÏÑ±
                </div>
                <div class="example-tag" onclick="setExampleQuery('Í≥†ÏÜåÎìùÏ∏µ Ï§ë Ìà¨Ïûê ÏÉÅÌíàÏóê Í¥ÄÏã¨ÏûàÎäî Í≥†Í∞ù')">
                    üìà Ìà¨Ïûê Í¥ÄÏã¨ Í≥†Í∞ù
                </div>
                <div class="example-tag" onclick="setExampleQuery('Ìï¥Ïô∏Ïó¨ÌñâÏùÑ ÏûêÏ£º Í∞ÄÎäî Í≥†Í∞ù Ï§ë Î≥¥Ìóò Í∞ÄÏûÖ Í∞ÄÎä•ÏÑ±Ïù¥ ÎÜíÏùÄ ÏÇ¨Îûå')">
                    ‚úàÔ∏è Ïó¨ÌñâÏûêÎ≥¥Ìóò ÎåÄÏÉÅ
                </div>
                <div class="example-tag" onclick="setExampleQuery('1Ïù∏ Í∞ÄÍµ¨ Ï§ë Î∞∞Îã¨ÏùåÏãùÏùÑ ÏûêÏ£º ÏãúÌÇ§Îäî Í≥†Í∞ù')">
                    üè† 1Ïù∏Í∞ÄÍµ¨ Î∞∞Îã¨Ï°±
                </div>
                <div class="example-tag" onclick="setExampleQuery('Í≥®ÌîÑÎ•º ÏπòÎäî Í≥†Í∞ù Ï§ë ÌîÑÎ¶¨ÎØ∏ÏóÑ ÏÑúÎπÑÏä§ Ïù¥Ïö© Í∞ÄÎä•ÏÑ±Ïù¥ ÎÜíÏùÄ ÏÇ¨Îûå')">
                    ‚õ≥ Í≥®ÌîÑ VIP Í≥†Í∞ù
                </div>
            </div>
        </div>
        
        <div class="loading" id="loadingSection">
            <div class="spinner"></div>
            <p>üß† AIÍ∞Ä CDP Îç∞Ïù¥ÌÑ∞Î•º Î∂ÑÏÑùÌïòÏó¨ ÏµúÏ†ÅÏùò Í≥†Í∞ù ÏÑ∏Í∑∏Î®ºÌÖåÏù¥ÏÖò Ï†ÑÎûµÏùÑ ÏÉùÏÑ±ÌïòÍ≥† ÏûàÏäµÎãàÎã§...</p>
        </div>
        
        <div class="results-container" id="resultsContainer">
            <div id="analysisResults"></div>
        </div>
    </div>

    <script>
        const OPENAI_API_KEY = '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';
        
        // CDP Ïª¨Îüº Ï†ïÏùò
        const CDP_COLUMNS = {
            // Í¥ÄÏã¨ÏÇ¨ Í∏∞Î∞ò ÏßÄÌëú (fa_int_*)
            interests: {
                'fa_int_householdsingle': '1Ïù∏ Í∞ÄÍµ¨ Í¥ÄÎ†® ÏÉÅÌíà Í≤∞Ï†ú',
                'fa_int_householdpet': 'Î∞òÎ†§ÎèôÎ¨º Í¥ÄÎ†® ÏÉÅÌíà Í≤∞Ï†ú',
                'fa_int_householdchild': 'Ïñ¥Î¶∞Ïù¥ Í¥ÄÎ†® ÏÉÅÌíà Í≤∞Ï†ú',
                'fa_int_householdbaby': 'ÏòÅÏú†ÏïÑ Í¥ÄÎ†® ÏÉÅÌíà Í≤∞Ï†ú',
                'fa_int_loan1stfinancial': '1Í∏àÏúµÍ∂å Ïã†Ïö©ÎåÄÏ∂ú Ïã§Ìñâ',
                'fa_int_loan2ndfinancial': '2Í∏àÏúµÍ∂å Ïã†Ïö©ÎåÄÏ∂ú Ïã§Ìñâ',
                'fa_int_loanpersonal': 'Ïã†Ïö©ÎåÄÏ∂ú Ïã§Ìñâ',
                'fa_int_saving': 'ÏòàÏ†ÅÍ∏à Í∞úÏÑ§',
                'fa_int_homeappliance': 'Í∞ÄÏ†Ñ ÏÉÅÌíà Í≤∞Ï†ú',
                'fa_int_luxury': 'Î™ÖÌíà Í¥ÄÎ†® Í≤∞Ï†ú',
                'fa_int_delivery': 'Î∞∞Îã¨ Í≤∞Ï†ú',
                'fa_int_carinsurance': 'ÏûêÎèôÏ∞® Î≥¥Ìóò Í≤∞Ï†ú ÏòàÏ†ï',
                'fa_int_carpurchase': 'Ï∞®Îüâ Íµ¨Îß§',
                'fa_int_traveloverseas': 'Ìï¥Ïô∏Ïó¨Ìñâ ÏòàÏ†ï',
                'fa_int_traveldomestic': 'Íµ≠ÎÇ¥Ïó¨Ìñâ',
                'fa_int_golf': 'Í≥®ÌîÑ Í¥ÄÎ†® Í≤∞Ï†ú',
                'fa_int_gym': 'ÌîºÌä∏ÎãàÏä§/Ìó¨Ïä§Ïû• Í≤∞Ï†ú',
                'fa_int_wedding': 'Í≤∞Ìòº Ï§ÄÎπÑ Í¥ÄÎ†®',
                'fa_int_highincome': 'Ï∂îÏ†ïÏÜåÎìù 1Ïñµ Ïù¥ÏÉÅ',
                'fa_int_homeowner': 'Ï£ºÌÉù ÏÜåÏú†',
                'fa_int_business': 'ÏÇ¨ÏóÖÏûê',
                'fa_int_worker': 'Ï†ïÍ∏∞ Í∏âÏó¨ ÏàòÎ†π'
            },
            
            // ÏóÖÏ¢ÖÎ≥Ñ ÏßÄÌëú (fa_ind_*)
            industries: {
                'fa_ind_finance': 'Í∏àÏúµ Í≤∞Ï†ú',
                'fa_ind_insurance': 'Î≥¥Ìóò Í≤∞Ï†ú',
                'fa_ind_beauty': 'ÎØ∏Ïö© Í≤∞Ï†ú',
                'fa_ind_medical': 'ÏùòÎ£å Í≤∞Ï†ú',
                'fa_ind_travel': 'Ïó¨Ìñâ Í≤∞Ï†ú',
                'fa_ind_foodbeverage': 'F&B Í≤∞Ï†ú',
                'fa_ind_cafe': 'Ïπ¥Ìéò Í≤∞Ï†ú',
                'fa_ind_restaurant': 'ÏùåÏãùÏ†ê Í≤∞Ï†ú',
                'fa_ind_delivery': 'Î∞∞Îã¨ Í≤∞Ï†ú',
                'fa_ind_cosmetic': 'Î∑∞Ìã∞ Í≤∞Ï†ú',
                'fa_ind_fashion': 'Ìå®ÏÖòÏùòÎ•ò Í≤∞Ï†ú',
                'fa_ind_digitalappliances': 'ÎîîÏßÄÌÑ∏Í∞ÄÏ†Ñ Í≤∞Ï†ú',
                'fa_ind_education': 'ÍµêÏú° Í≤∞Ï†ú',
                'fa_ind_golfcourse': 'Í≥®ÌîÑÏû• Í≤∞Ï†ú',
                'fa_ind_fitness': 'ÌîºÌä∏ÎãàÏä§ Í≤∞Ï†ú'
            },
            
            // ÏòàÏ∏° Ïä§ÏΩîÏñ¥ (sc_*)
            scores: {
                'sc_int_loan1stfinancial': '1Í∏àÏúµÍ∂å ÎåÄÏ∂ú ÏòàÏ∏°Ïä§ÏΩîÏñ¥',
                'sc_int_loan2ndfinancial': '2Í∏àÏúµÍ∂å ÎåÄÏ∂ú ÏòàÏ∏°Ïä§ÏΩîÏñ¥',
                'sc_int_luxury': 'Î™ÖÌíà Íµ¨Îß§ ÏòàÏ∏°Ïä§ÏΩîÏñ¥',
                'sc_int_delivery': 'Î∞∞Îã¨ Ïù¥Ïö© ÏòàÏ∏°Ïä§ÏΩîÏñ¥',
                'sc_int_golf': 'Í≥®ÌîÑ Í¥ÄÎ†® ÏòàÏ∏°Ïä§ÏΩîÏñ¥',
                'sc_int_highincome': 'Í≥†ÏÜåÎìù ÏòàÏ∏°Ïä§ÏΩîÏñ¥',
                'sc_int_wedding': 'Í≤∞Ìòº Ï§ÄÎπÑ ÏòàÏ∏°Ïä§ÏΩîÏñ¥',
                'sc_ind_beauty': 'ÎØ∏Ïö© ÏÑúÎπÑÏä§ ÏòàÏ∏°Ïä§ÏΩîÏñ¥',
                'sc_ind_cosmetic': 'Î∑∞Ìã∞ Ï†úÌíà ÏòàÏ∏°Ïä§ÏΩîÏñ¥',
                'sc_ind_finance': 'Í∏àÏúµ ÏÑúÎπÑÏä§ ÏòàÏ∏°Ïä§ÏΩîÏñ¥'
            },
            
            // ÌîåÎûòÍ∑∏ ÏßÄÌëú (fi_npay_*)
            flags: {
                'fi_npay_age20': '20ÎåÄ',
                'fi_npay_age30': '30ÎåÄ',
                'fi_npay_age40': '40ÎåÄ',
                'fi_npay_genderf': 'Ïó¨ÏÑ±',
                'fi_npay_genderm': 'ÎÇ®ÏÑ±',
                'fi_npay_membershipnormal': 'ÌîåÎü¨Ïä§Î©§Î≤ÑÏã≠ Í∞ÄÏûÖ',
                'fi_npay_myassetreg': 'ÎÇ¥ÏûêÏÇ∞ ÏÑúÎπÑÏä§ Ïó∞Îèô',
                'fi_npay_creditcheck': 'Ïã†Ïö©Ï°∞Ìöå ÏÑúÎπÑÏä§ Í∞ÄÏûÖ'
            }
        };
        
        // ÌÇ§ ÏûÖÎ†• Ï≤òÎ¶¨
        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                processQuery();
            }
        }
        
        // ÏòàÏãú ÏøºÎ¶¨ ÏÑ§Ï†ï
        function setExampleQuery(query) {
            document.getElementById('queryInput').value = query;
        }
        
        // ÏøºÎ¶¨ Ï≤òÎ¶¨ Î©îÏù∏ Ìï®Ïàò
        async function processQuery() {
            const query = document.getElementById('queryInput').value.trim();
            
            if (!query) {
                alert('ÏßàÎ¨∏ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            // Î°úÎî© ÌëúÏãú
            document.getElementById('loadingSection').style.display = 'block';
            document.getElementById('resultsContainer').style.display = 'none';
            
            try {
                // OpenAI API Ìò∏Ï∂ú
                const result = await analyzeQueryWithAI(query);
                displayResults(result);
            } catch (error) {
                console.error('Error:', error);
                displayError('Î∂ÑÏÑù Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§. Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.');
            } finally {
                document.getElementById('loadingSection').style.display = 'none';
                document.getElementById('resultsContainer').style.display = 'block';
            }
        }
        
        // OpenAI API Ìò∏Ï∂ú
        async function analyzeQueryWithAI(userQuery) {
            const prompt = createAnalysisPrompt(userQuery);
            
            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${OPENAI_API_KEY}`
                },
                body: JSON.stringify({
                    model: 'gpt-4',
                    messages: [
                        {
                            role: 'system',
                            content: `ÎãπÏã†ÏùÄ CDP(Customer Data Platform) Ï†ÑÎ¨∏Í∞ÄÏûÖÎãàÎã§. ÏÇ¨Ïö©ÏûêÏùò ÏûêÏó∞Ïñ¥ ÏßàÎ¨∏ÏùÑ Î∂ÑÏÑùÌïòÏó¨ ÏµúÏ†ÅÏùò Í≥†Í∞ù ÏÑ∏Í∑∏Î®ºÌÖåÏù¥ÏÖò Ï†ÑÎûµÏùÑ Ï†úÍ≥µÌï©ÎãàÎã§.
                            
                            Îã§Ïùå CDP Ïª¨ÎüºÎì§ÏùÑ ÌôúÏö©ÌïòÏó¨ Î∂ÑÏÑùÌï¥Ï£ºÏÑ∏Ïöî:
                            ${JSON.stringify(CDP_COLUMNS, null, 2)}
                            
                            ÏùëÎãµÏùÄ Î∞òÎìúÏãú Îã§Ïùå JSON ÌòïÏãùÏúºÎ°ú Ï†úÍ≥µÌï¥Ï£ºÏÑ∏Ïöî:
                            {
                                "query_analysis": "ÏÇ¨Ïö©Ïûê ÏßàÎ¨∏ Î∂ÑÏÑù ÎÇ¥Ïö©",
                                "target_description": "ÌÉÄÍ≤ü Í≥†Í∞ùÍµ∞ ÏÑ§Î™Ö",
                                "recommended_columns": [
                                    {
                                        "column": "Ïª¨ÎüºÎ™Ö",
                                        "description": "Ïª¨Îüº ÏÑ§Î™Ö",
                                        "condition": "Ï∂îÏ≤ú Ï°∞Í±¥ (Ïòà: > 0.7, IS NOT NULL Îì±)",
                                        "priority": "high|medium|low",
                                        "reasoning": "ÏÑ†ÌÉù Ïù¥Ïú†"
                                    }
                                ],
                                "sql_query": "SELECT Î¨∏ÏúºÎ°ú Îêú ÏøºÎ¶¨",
                                "business_insights": [
                                    "ÎπÑÏ¶àÎãàÏä§ Ïù∏ÏÇ¨Ïù¥Ìä∏ 1",
                                    "ÎπÑÏ¶àÎãàÏä§ Ïù∏ÏÇ¨Ïù¥Ìä∏ 2"
                                ],
                                "estimated_target_size": "ÏòàÏÉÅ ÌÉÄÍ≤ü Í∑úÎ™® (%)",
                                "marketing_recommendations": [
                                    "ÎßàÏºÄÌåÖ Ï∂îÏ≤úÏÇ¨Ìï≠ 1",
                                    "ÎßàÏºÄÌåÖ Ï∂îÏ≤úÏÇ¨Ìï≠ 2"
                                ]
                            }`
                        },
                        {
                            role: 'user',
                            content: userQuery
                        }
                    ],
                    temperature: 0.7,
                    max_tokens: 2000
                })
            });
            
            if (!response.ok) {
                throw new Error(`OpenAI API Error: ${response.status}`);
            }
            
            const data = await response.json();
            const aiResponse = data.choices[0].message.content;
            
            try {
                return JSON.parse(aiResponse);
            } catch (parseError) {
                // JSON ÌååÏã± Ïã§Ìå® Ïãú ÎçîÎØ∏ Îç∞Ïù¥ÌÑ∞ Î∞òÌôò
                return generateFallbackResult(userQuery);
            }
        }
        
        // Î∂ÑÏÑù ÌîÑÎ°¨ÌîÑÌä∏ ÏÉùÏÑ±
        function createAnalysisPrompt(query) {
            return `
ÏÇ¨Ïö©Ïûê ÏßàÎ¨∏: "${query}"

ÏúÑ ÏßàÎ¨∏ÏùÑ Î∂ÑÏÑùÌïòÏó¨ Îã§ÏùåÏùÑ Ï†úÍ≥µÌï¥Ï£ºÏÑ∏Ïöî:

1. ÏßàÎ¨∏Ïùò ÌïµÏã¨ ÏöîÍµ¨ÏÇ¨Ìï≠ Î∂ÑÏÑù
2. ÌÉÄÍ≤ü Í≥†Í∞ùÍµ∞ÏùÑ Ï†ïÏùòÌïòÍ∏∞ ÏúÑÌïú ÏµúÏ†ÅÏùò CDP Ïª¨Îüº Ï°∞Ìï© Ï∂îÏ≤ú
3. Í∞Å Ïª¨ÎüºÏùÑ ÏÑ†ÌÉùÌïú Ïù¥Ïú†ÏôÄ Ï∂îÏ≤ú Ï°∞Í±¥Í∞í
4. Ïã§Ìñâ Í∞ÄÎä•Ìïú SQL ÏøºÎ¶¨
5. ÎπÑÏ¶àÎãàÏä§ Ïù∏ÏÇ¨Ïù¥Ìä∏ Î∞è ÎßàÏºÄÌåÖ ÌôúÏö© Î∞©Ïïà

CDP Îç∞Ïù¥ÌÑ∞Ïùò ÌäπÏÑ±:
- fa_int_*: Í¥ÄÏã¨ÏÇ¨ Í∏∞Î∞ò ÌñâÎèô ÏßÄÌëú (date ÌÉÄÏûÖ, Ïù¥Î≤§Ìä∏ Î∞úÏÉùÏùº)
- fa_ind_*: ÏóÖÏ¢ÖÎ≥Ñ Í≤∞Ï†ú ÏßÄÌëú (date ÌÉÄÏûÖ, Í≤∞Ï†úÏùº)
- sc_*: AI ÏòàÏ∏° Ïä§ÏΩîÏñ¥ (0-1 Î≤îÏúÑÏùò double ÌÉÄÏûÖ)
- fi_npay_*: ÌîåÎûòÍ∑∏ ÏßÄÌëú (boolean ÌÉÄÏûÖ)
            `;
        }
        
        // Ìè¥Î∞± Í≤∞Í≥º ÏÉùÏÑ± (API Ïã§Ìå® Ïãú)
        function generateFallbackResult(query) {
            const loanKeywords = ['ÎåÄÏ∂ú', 'ÎπåÎ†§', 'Ïã†Ïö©', 'Í∏àÏúµ', 'Îèà'];
            const beautyKeywords = ['Î∑∞Ìã∞', 'ÌôîÏû•Ìíà', 'ÎØ∏Ïö©', 'ÏΩîÏä§Î©îÌã±'];
            const travelKeywords = ['Ïó¨Ìñâ', 'Ìï¥Ïô∏', 'Ìï≠Í≥µ', 'Ìò∏ÌÖî'];
            
            let targetType = 'ÏùºÎ∞ò';
            if (loanKeywords.some(keyword => query.includes(keyword))) {
                targetType = 'ÎåÄÏ∂ú';
            } else if (beautyKeywords.some(keyword => query.includes(keyword))) {
                targetType = 'Î∑∞Ìã∞';
            } else if (travelKeywords.some(keyword => query.includes(keyword))) {
                targetType = 'Ïó¨Ìñâ';
            }
            
            return generateTargetRecommendation(targetType, query);
        }
        
        // ÌÉÄÍ≤üÎ≥Ñ Ï∂îÏ≤ú ÏÉùÏÑ±
        function generateTargetRecommendation(targetType, originalQuery) {
            const recommendations = {
                'ÎåÄÏ∂ú': {
                    query_analysis: 'ÏÇ¨Ïö©ÏûêÍ∞Ä ÎåÄÏ∂ú ÎãàÏ¶àÍ∞Ä ÎÜíÏùÄ Í≥†Í∞ùÍµ∞ÏùÑ ÏöîÏ≤≠ÌñàÏäµÎãàÎã§.',
                    target_description: 'ÎåÄÏ∂ú ÏÉÅÌíàÏóê Í¥ÄÏã¨Ïù¥ ÎÜíÍ≥† Ïã†Ï≤≠ Í∞ÄÎä•ÏÑ±Ïù¥ ÎÜíÏùÄ Í≥†Í∞ùÍµ∞',
                    recommended_columns: [
                        {
                            column: 'sc_int_loan1stfinancial',
                            description: '1Í∏àÏúµÍ∂å Ïã†Ïö©ÎåÄÏ∂ú ÏòàÏ∏°Ïä§ÏΩîÏñ¥',
                            condition: '> 0.7',
                            priority: 'high',
                            reasoning: '1Í∏àÏúµÍ∂å ÎåÄÏ∂ú Ïã†Ï≤≠ Í∞ÄÎä•ÏÑ±Ïù¥ ÎÜíÏùÄ Í≥†Í∞ùÏùÑ Ïö∞ÏÑ† ÌÉÄÍ≤üÌåÖ'
                        },
                        {
                            column: 'fa_int_loanpersonal',
                            description: 'ÏµúÍ∑º Ïã†Ïö©ÎåÄÏ∂ú Ïã§Ìñâ Ïù¥Î†•',
                            condition: 'IS NOT NULL',
                            priority: 'high',
                            reasoning: 'Í∏∞Ï°¥ ÎåÄÏ∂ú Í≤ΩÌóòÏù¥ ÏûàÏñ¥ Ï∂îÍ∞Ä ÎåÄÏ∂ú ÎãàÏ¶àÍ∞Ä ÏûàÏùÑ Í∞ÄÎä•ÏÑ±'
                        },
                        {
                            column: 'fi_npay_creditcheck',
                            description: 'Ïã†Ïö©Ï°∞Ìöå ÏÑúÎπÑÏä§ Í∞ÄÏûÖ',
                            condition: '= true',
                            priority: 'medium',
                            reasoning: 'Ïã†Ïö© Í¥ÄÎ¶¨Ïóê Í¥ÄÏã¨Ïù¥ ÎÜíÏïÑ ÎåÄÏ∂ú ÏÉÅÌíàÏóêÎèÑ Í¥ÄÏã¨Ïù¥ ÏûàÏùÑ Í≤É'
                        },
                        {
                            column: 'sc_int_highincome',
                            description: 'Í≥†ÏÜåÎìù ÏòàÏ∏°Ïä§ÏΩîÏñ¥',
                            condition: '> 0.6',
                            priority: 'medium',
                            reasoning: 'ÏïàÏ†ïÏ†Å ÏÜåÎìùÏúºÎ°ú ÎåÄÏ∂ú ÏÉÅÌôò Îä•Î†•Ïù¥ Í≤ÄÏ¶ùÎêú Í≥†Í∞ù'
                        }
                    ],
                    sql_query: `SELECT mbr_id_no, 
       sc_int_loan1stfinancial,
       fa_int_loanpersonal,
       fi_npay_creditcheck,
       sc_int_highincome
FROM cdp_customer_data 
WHERE sc_int_loan1stfinancial > 0.7 
   OR (fa_int_loanpersonal IS NOT NULL AND fi_npay_creditcheck = true)
   OR (sc_int_highincome > 0.6 AND fi_npay_creditcheck = true)
ORDER BY sc_int_loan1stfinancial DESC;`,
                    business_insights: [
                        'Í≥†ÏÜåÎìùÏ∏µÏùºÏàòÎ°ù ÎåÄÏ∂ú ÌïúÎèÑÍ∞Ä ÎÜíÏïÑ ÏàòÏùµÏÑ±Ïù¥ Ï¢ãÏäµÎãàÎã§',
                        'Í∏∞Ï°¥ ÎåÄÏ∂ú Í≥†Í∞ùÏùò ÎåÄÌôòÎåÄÏ∂ú ÎãàÏ¶àÎ•º Ï†ÅÍ∑π ÌôúÏö©Ìï† Ïàò ÏûàÏäµÎãàÎã§',
                        'Ïã†Ïö©Ï°∞Ìöå ÏÑúÎπÑÏä§ Ïù¥Ïö©ÏûêÎäî Í∏àÏúµ ÏÉÅÌíàÏóê ÎåÄÌïú Í¥ÄÏã¨ÎèÑÍ∞Ä ÎÜíÏäµÎãàÎã§'
                    ],
                    estimated_target_size: '15-20%',
                    marketing_recommendations: [
                        'ÎßûÏ∂§Ìòï ÎåÄÏ∂ú ÏÉÅÌíà Ï∂îÏ≤ú Î©îÏãúÏßÄ Î∞úÏÜ°',
                        'Ïã†Ïö©Ï†êÏàò Í∏∞Î∞ò Ïö∞ÎåÄÍ∏àÎ¶¨ Ï†úÏïà',
                        'Í∏∞Ï°¥ ÎåÄÏ∂ú Í≥†Í∞ù ÎåÄÏÉÅ ÎåÄÌôòÎåÄÏ∂ú ÏÉÅÎã¥ Ï†úÏïà',
                        'Ïã†Ïö©Ï°∞Ìöå ÏÑúÎπÑÏä§ÏôÄ Ïó∞Í≥ÑÌïú ÎåÄÏ∂ú ÏÉÅÌíà ÏïàÎÇ¥'
                    ]
                },
                'Î∑∞Ìã∞': {
                    query_analysis: 'Î∑∞Ìã∞/ÌôîÏû•ÌíàÏóê Í¥ÄÏã¨Ïù¥ ÎÜíÏùÄ Í≥†Í∞ùÍµ∞ÏùÑ ÏöîÏ≤≠ÌñàÏäµÎãàÎã§.',
                    target_description: 'Î∑∞Ìã∞ Î∞è ÌôîÏû•Ìíà Íµ¨Îß§ ÌôúÎèôÏù¥ ÌôúÎ∞úÌïú Í≥†Í∞ùÍµ∞',
                    recommended_columns: [
                        {
                            column: 'sc_ind_cosmetic',
                            description: 'Î∑∞Ìã∞ Ï†úÌíà Í≤∞Ï†ú ÏòàÏ∏°Ïä§ÏΩîÏñ¥',
                            condition: '> 0.8',
                            priority: 'high',
                            reasoning: 'Î∑∞Ìã∞ Ï†úÌíà Íµ¨Îß§ Í∞ÄÎä•ÏÑ±Ïù¥ Îß§Ïö∞ ÎÜíÏùÄ ÌïµÏã¨ ÌÉÄÍ≤ü'
                        },
                        {
                            column: 'fa_ind_beauty',
                            description: 'ÎØ∏Ïö© ÏÑúÎπÑÏä§ Í≤∞Ï†ú Ïù¥Î†•',
                            condition: 'IS NOT NULL',
                            priority: 'high',
                            reasoning: 'ÎØ∏Ïö©Ïã§, ÎÑ§ÏùºÏÉµ Îì± Î∑∞Ìã∞ ÏÑúÎπÑÏä§ Ïù¥Ïö©ÏúºÎ°ú Í¥ÄÏã¨ÎèÑ ÌôïÏù∏'
                        },
                        {
                            column: 'fi_npay_genderf',
                            description: 'Ïó¨ÏÑ± Í≥†Í∞ù',
                            condition: '= true',
                            priority: 'medium',
                            reasoning: 'Î∑∞Ìã∞ Ï†úÌíàÏùò Ï£ºÏöî ÌÉÄÍ≤üÏ∏µÏù∏ Ïó¨ÏÑ± Í≥†Í∞ù'
                        },
                        {
                            column: 'fi_npay_age20',
                            description: '20ÎåÄ Ïó∞Î†πÏ∏µ',
                            condition: '= true',
                            priority: 'medium',
                            reasoning: 'Î∑∞Ìã∞ Ìä∏Î†åÎìúÏóê ÎØºÍ∞êÌïú Ï†äÏùÄ Ïó∞Î†πÏ∏µ'
                        }
                    ],
                    sql_query: `SELECT mbr_id_no,
       sc_ind_cosmetic,
       fa_ind_beauty,
       fi_npay_genderf,
       fi_npay_age20
FROM cdp_customer_data
WHERE sc_ind_cosmetic > 0.8
   OR (fa_ind_beauty IS NOT NULL AND fi_npay_genderf = true)
   OR (fi_npay_genderf = true AND fi_npay_age20 = true AND sc_ind_cosmetic > 0.5)
ORDER BY sc_ind_cosmetic DESC;`,
                    business_insights: [
                        'Ï†äÏùÄ Ïó¨ÏÑ±Ï∏µÏùò Î∑∞Ìã∞ ÏßÄÏ∂úÏù¥ ÏßÄÏÜçÏ†ÅÏúºÎ°ú Ï¶ùÍ∞ÄÌïòÍ≥† ÏûàÏäµÎãàÎã§',
                        'ÎØ∏Ïö© ÏÑúÎπÑÏä§ÏôÄ Î∑∞Ìã∞ Ï†úÌíàÏùÑ Ìï®Íªò Ïù¥Ïö©ÌïòÎäî Í≥†Í∞ùÏùò LTVÍ∞Ä ÎÜíÏäµÎãàÎã§',
                        'Ïò®ÎùºÏù∏ Î∑∞Ìã∞ Ïª§Î®∏Ïä§ ÏãúÏû•Ïù¥ Îπ†Î•¥Í≤å ÏÑ±Ïû•ÌïòÍ≥† ÏûàÏäµÎãàÎã§'
                    ],
                    estimated_target_size: '25-30%',
                    marketing_recommendations: [
                        'Î∑∞Ìã∞ Ïù∏ÌîåÎ£®Ïñ∏ÏÑúÏôÄ ÌòëÏóÖÌïú Ï†úÌíà Ï∂îÏ≤ú',
                        'Í∞úÏù∏ ÎßûÏ∂§Ìòï Î∑∞Ìã∞ Î£®Ìã¥ Ï†úÏïà',
                        'ÎØ∏Ïö©Ïã§ Ïó∞Í≥Ñ Ï†úÌíà Ìï†Ïù∏ Ïø†Ìè∞ Ï†úÍ≥µ',
                        'Î∑∞Ìã∞ Ìä∏Î†åÎìú Ï†ïÎ≥¥ÏôÄ Ìï®ÍªòÌïòÎäî Ï†úÌíà Í¥ëÍ≥†'
                    ]
                },
                'Ïó¨Ìñâ': {
                    query_analysis: 'Ïó¨Ìñâ Í¥ÄÎ†® ÏÉÅÌíà/ÏÑúÎπÑÏä§Ïóê Í¥ÄÏã¨Ïù¥ ÎÜíÏùÄ Í≥†Í∞ùÍµ∞ÏùÑ ÏöîÏ≤≠ÌñàÏäµÎãàÎã§.',
                    target_description: 'Ïó¨ÌñâÏùÑ ÏûêÏ£º Îã§ÎãàÎ©∞ Ïó¨Ìñâ Í¥ÄÎ†® ÏßÄÏ∂úÏù¥ ÌôúÎ∞úÌïú Í≥†Í∞ùÍµ∞',
                    recommended_columns: [
                        {
                            column: 'fa_int_traveloverseas',
                            description: 'Ìï¥Ïô∏Ïó¨Ìñâ ÏòàÏ†ï Í≥†Í∞ù',
                            condition: 'IS NOT NULL',
                            priority: 'high',
                            reasoning: 'Ìï¥Ïô∏Ïó¨Ìñâ Í≥ÑÌöçÏù¥ ÏûàÏñ¥ Ïó¨Ìñâ ÏÉÅÌíà Íµ¨Îß§ Í∞ÄÎä•ÏÑ±Ïù¥ ÎÜíÏùå'
                        },
                        {
                            column: 'fa_ind_travel',
                            description: 'Ïó¨Ìñâ Í¥ÄÎ†® Í≤∞Ï†ú Ïù¥Î†•',
                            condition: 'IS NOT NULL',
                            priority: 'high',
                            reasoning: 'Ïó¨ÌñâÏÇ¨, Ìï≠Í≥µÍ∂å Îì± Ïó¨Ìñâ ÏÉÅÌíà Íµ¨Îß§ Í≤ΩÌóòÏù¥ ÏûàÏùå'
                        },
                        {
                            column: 'fa_ind_airsevice',
                            description: 'Ìï≠Í≥µ ÏÑúÎπÑÏä§ Ïù¥Ïö©',
                            condition: 'IS NOT NULL',
                            priority: 'medium',
                            reasoning: 'Ìï≠Í≥µÌé∏ Ïù¥Ïö©ÏúºÎ°ú Ï§ëÏû•Í±∞Î¶¨ Ïó¨Ìñâ ÏÑ†Ìò∏ÎèÑ ÌôïÏù∏'
                        },
                        {
                            column: 'sc_int_highincome',
                            description: 'Í≥†ÏÜåÎìù ÏòàÏ∏°Ïä§ÏΩîÏñ¥',
                            condition: '> 0.6',
                            priority: 'medium',
                            reasoning: 'Ïó¨ÌñâÏóê Ï∂©Î∂ÑÌïú ÏßÄÏ∂úÏù¥ Í∞ÄÎä•Ìïú Í≤ΩÏ†úÎ†• Î≥¥Ïú†'
                        }
                    ],
                    sql_query: `SELECT mbr_id_no,
       fa_int_traveloverseas,
       fa_ind_travel,
       fa_ind_airsevice,
       sc_int_highincome
FROM cdp_customer_data
WHERE fa_int_traveloverseas IS NOT NULL
   OR (fa_ind_travel IS NOT NULL AND sc_int_highincome > 0.6)
   OR (fa_ind_airsevice IS NOT NULL AND fa_ind_travel IS NOT NULL)
ORDER BY sc_int_highincome DESC;`,
                    business_insights: [
                        'Ìï¥Ïô∏Ïó¨Ìñâ ÏàòÏöîÍ∞Ä ÏΩîÎ°úÎÇò19 Ïù¥ÌõÑ Í∏âÍ≤©Ìûà ÌöåÎ≥µÎêòÍ≥† ÏûàÏäµÎãàÎã§',
                        'Í≥†ÏÜåÎìùÏ∏µÏùºÏàòÎ°ù ÌîÑÎ¶¨ÎØ∏ÏóÑ Ïó¨Ìñâ ÏÉÅÌíàÏùÑ ÏÑ†Ìò∏Ìï©ÎãàÎã§',
                        'Ïó¨ÌñâÏûêÎ≥¥Ìóò, ÌôòÏ†Ñ Îì± Î∂ÄÍ∞Ä ÏÑúÎπÑÏä§ ÏàòÏöîÎèÑ Ìï®Íªò Ï¶ùÍ∞ÄÌï©ÎãàÎã§'
                    ],
                    estimated_target_size: '12-18%',
                    marketing_recommendations: [
                        'ÏãúÏ¶åÎ≥Ñ Ïó¨Ìñâ Ìå®ÌÇ§ÏßÄ ÏÉÅÌíà Ï∂îÏ≤ú',
                        'Ïó¨ÌñâÏûêÎ≥¥Ìóò ÏÉÅÌíàÍ≥º Ïó∞Í≥Ñ ÎßàÏºÄÌåÖ',
                        'Ìï≠Í≥µÎßàÏùºÎ¶¨ÏßÄ Ï†ÅÎ¶Ω ÌòúÌÉù Í∞ïÌôî',
                        'Ïó¨Ìñâ Í¥ÄÎ†® Í∏àÏúµ ÏÉÅÌíà(Ïó¨ÌñâÏ†ÅÍ∏à, ÌôòÏ†Ñ) Ï†úÏïà'
                    ]
                }
            };
            
            return recommendations[targetType] || recommendations['ÏùºÎ∞ò'] || {
                query_analysis: originalQuery + 'Ïóê ÎåÄÌïú Î∂ÑÏÑùÏùÑ ÏàòÌñâÌñàÏäµÎãàÎã§.',
                target_description: 'ÏöîÏ≤≠ÌïòÏã† Ï°∞Í±¥Ïóê ÎßûÎäî Í≥†Í∞ùÍµ∞',
                recommended_columns: [],
                sql_query: 'SELECT * FROM cdp_customer_data LIMIT 100;',
                business_insights: ['Ï∂îÍ∞Ä Î∂ÑÏÑùÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.'],
                estimated_target_size: '10-15%',
                marketing_recommendations: ['ÎßûÏ∂§Ìòï ÎßàÏºÄÌåÖ Ï†ÑÎûµÏùÑ ÏàòÎ¶ΩÌï¥Î≥¥ÏÑ∏Ïöî.']
            };
        }
        
        // Í≤∞Í≥º ÌëúÏãú
        function displayResults(result) {
            const resultsDiv = document.getElementById('analysisResults');
            
            resultsDiv.innerHTML = `
                <div class="analysis-result">
                    <div class="analysis-title">ÏßàÎ¨∏ Î∂ÑÏÑù Í≤∞Í≥º</div>
                    <p>${result.query_analysis}</p>
                </div>
                
                <div class="analysis-result">
                    <div class="analysis-title">ÌÉÄÍ≤ü Í≥†Í∞ùÍµ∞ Ï†ïÏùò</div>
                    <p>${result.target_description}</p>
                </div>
                
                <div class="stats-section">
                    <div class="stat-card">
                        <div class="stat-number">${result.recommended_columns.length}</div>
                        <div class="stat-label">Ï∂îÏ≤ú Ïª¨Îüº Ïàò</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${result.estimated_target_size}</div>
                        <div class="stat-label">ÏòàÏÉÅ ÌÉÄÍ≤ü Í∑úÎ™®</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${result.marketing_recommendations.length}</div>
                        <div class="stat-label">ÎßàÏºÄÌåÖ Ï†úÏïà</div>
                    </div>
                </div>
                
                <div class="analysis-result">
                    <div class="analysis-title">Ï∂îÏ≤ú CDP Ïª¨Îüº Ï°∞Ìï©</div>
                    <div class="column-recommendations">
                        ${generateColumnRecommendations(result.recommended_columns)}
                    </div>
                </div>
                
                <div class="reasoning-section">
                    <h4>üß† AI Î∂ÑÏÑù Í∑ºÍ±∞</h4>
                    ${result.recommended_columns.map(col => `
                        <div class="reasoning-item">
                            <strong>${col.column}:</strong> ${col.reasoning}
                        </div>
                    `).join('')}
                </div>
                
                <div class="sql-section">
                    <h4>üìù Ïã§Ìñâ Í∞ÄÎä•Ìïú SQL ÏøºÎ¶¨</h4>
                    <div class="sql-query">${result.sql_query}</div>
                    <button class="copy-button" onclick="copyToClipboard('${result.sql_query.replace(/'/g, "\\'")}')">
                        üìã ÏøºÎ¶¨ Î≥µÏÇ¨
                    </button>
                </div>
                
                <div class="analysis-result">
                    <div class="analysis-title">ÎπÑÏ¶àÎãàÏä§ Ïù∏ÏÇ¨Ïù¥Ìä∏</div>
                    ${result.business_insights.map(insight => `<p>‚Ä¢ ${insight}</p>`).join('')}
                </div>
                
                <div class="analysis-result">
                    <div class="analysis-title">ÎßàÏºÄÌåÖ ÌôúÏö© Î∞©Ïïà</div>
                    ${result.marketing_recommendations.map(rec => `<p>‚Ä¢ ${rec}</p>`).join('')}
                </div>
                
                <div class="export-section">
                    <h4>üìä Í≤∞Í≥º ÎÇ¥Î≥¥ÎÇ¥Í∏∞</h4>
                    <button class="export-button" onclick="exportToCSV()">CSV Îã§Ïö¥Î°úÎìú</button>
                    <button class="export-button" onclick="exportToPDF()">PDF Î¶¨Ìè¨Ìä∏</button>
                    <button class="export-button" onclick="shareResults()">Í≤∞Í≥º Í≥µÏú†</button>
                </div>
            `;
        }
        
        // Ïª¨Îüº Ï∂îÏ≤ú HTML ÏÉùÏÑ±
        function generateColumnRecommendations(columns) {
            const grouped = {
                high: columns.filter(c => c.priority === 'high'),
                medium: columns.filter(c => c.priority === 'medium'),
                low: columns.filter(c => c.priority === 'low')
            };
            
            return Object.entries(grouped).map(([priority, cols]) => {
                if (cols.length === 0) return '';
                
                const priorityLabels = {
                    high: 'üî• ÌïµÏã¨ ÏßÄÌëú',
                    medium: '‚≠ê Î≥¥Ï°∞ ÏßÄÌëú',
                    low: 'üí° Ï∞∏Í≥† ÏßÄÌëú'
                };
                
                return `
                    <div class="column-group">
                        <h4>${priorityLabels[priority]}</h4>
                        ${cols.map(col => `
                            <div class="column-item">
                                <div>
                                    <div class="column-name">${col.column}</div>
                                    <div style="font-size: 0.9em; color: #6c757d; margin-top: 2px;">
                                        ${col.description}
                                    </div>
                                    <div style="font-size: 0.8em; color: #4CAF50; margin-top: 2px;">
                                        Ï°∞Í±¥: ${col.condition}
                                    </div>
                                </div>
                                <div class="column-score">${priority.toUpperCase()}</div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }).join('');
        }
        
        // ÏóêÎü¨ ÌëúÏãú
        function displayError(message) {
            const resultsDiv = document.getElementById('analysisResults');
            resultsDiv.innerHTML = `
                <div class="analysis-result" style="border-left-color: #dc3545;">
                    <div class="analysis-title" style="color: #dc3545;">‚ö†Ô∏è Ïò§Î•ò Î∞úÏÉù</div>
                    <p>${message}</p>
                    <p>Îã§Ïãú ÏãúÎèÑÌïòÏãúÍ±∞ÎÇò Îã§Î•∏ ÏßàÎ¨∏ÏúºÎ°ú Î¨ºÏñ¥Î≥¥ÏÑ∏Ïöî.</p>
                </div>
            `;
        }
        
        // Ïú†Ìã∏Î¶¨Ìã∞ Ìï®ÏàòÎì§
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert('ÏøºÎ¶¨Í∞Ä ÌÅ¥Î¶ΩÎ≥¥ÎìúÏóê Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§!');
            });
        }
        
        function exportToCSV() {
            alert('CSV ÎÇ¥Î≥¥ÎÇ¥Í∏∞ Í∏∞Îä•Ïù¥ Í≥ß Ï†úÍ≥µÎê† ÏòàÏ†ïÏûÖÎãàÎã§.');
        }
        
        function exportToPDF() {
            alert('PDF Î¶¨Ìè¨Ìä∏ Í∏∞Îä•Ïù¥ Í≥ß Ï†úÍ≥µÎê† ÏòàÏ†ïÏûÖÎãàÎã§.');
        }
        
        function shareResults() {
            alert('Í≤∞Í≥º Í≥µÏú† Í∏∞Îä•Ïù¥ Í≥ß Ï†úÍ≥µÎê† ÏòàÏ†ïÏûÖÎãàÎã§.');
        }
        
        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ï¥àÍ∏∞Ìôî
        document.addEventListener('DOMContentLoaded', function() {
            console.log('CDP AI ÏûêÏó∞Ïñ¥ ÏøºÎ¶¨ ÌîåÎû´ÌèºÏù¥ Î°úÎìúÎêòÏóàÏäµÎãàÎã§.');
            
            // Ï≤´ Î≤àÏß∏ ÏòàÏãú ÏßàÎ¨∏ÏùÑ ÎØ∏Î¶¨ ÏÑ§Ï†ï
            document.getElementById('queryInput').focus();
        });
    </script>
</body>
</html>