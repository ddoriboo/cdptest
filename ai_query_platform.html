<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CDP AI ìì—°ì–´ ì¿¼ë¦¬ í”Œë«í¼</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .query-section {
            padding: 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }
        
        .query-input-container {
            position: relative;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .query-input {
            width: 100%;
            padding: 20px 60px 20px 20px;
            font-size: 18px;
            border: 2px solid #e9ecef;
            border-radius: 25px;
            outline: none;
            transition: border-color 0.3s ease;
            background: white;
        }
        
        .query-input:focus {
            border-color: #4CAF50;
        }
        
        .query-input::placeholder {
            color: #6c757d;
        }
        
        .query-button {
            position: absolute;
            right: 5px;
            top: 50%;
            transform: translateY(-50%);
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            border: none;
            padding: 15px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .query-button:hover {
            transform: translateY(-50%) scale(1.05);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
        }
        
        .query-examples {
            margin-top: 20px;
            text-align: center;
        }
        
        .example-tag {
            display: inline-block;
            background: white;
            color: #495057;
            padding: 8px 15px;
            margin: 5px;
            border-radius: 20px;
            border: 1px solid #dee2e6;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }
        
        .example-tag:hover {
            background: #4CAF50;
            color: white;
            transform: translateY(-2px);
        }
        
        .results-container {
            padding: 30px;
            display: none;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            display: none;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4CAF50;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .analysis-result {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            border-left: 5px solid #4CAF50;
        }
        
        .analysis-title {
            font-size: 1.4em;
            color: #2c3e50;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        
        .analysis-title::before {
            content: "ğŸ¯";
            margin-right: 10px;
        }
        
        .column-recommendations {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .column-group {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #e9ecef;
        }
        
        .column-group h4 {
            color: #495057;
            margin-bottom: 15px;
            font-size: 1.1em;
            display: flex;
            align-items: center;
        }
        
        .column-item {
            background: #f8f9fa;
            padding: 10px 15px;
            margin: 8px 0;
            border-radius: 8px;
            border-left: 3px solid #4CAF50;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .column-name {
            font-weight: 500;
            color: #2c3e50;
        }
        
        .column-score {
            background: #4CAF50;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .reasoning-section {
            background: linear-gradient(135deg, #ff7e5f 0%, #feb47b 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
        }
        
        .reasoning-section h4 {
            margin-bottom: 15px;
            font-size: 1.2em;
        }
        
        .reasoning-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 12px 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 3px solid rgba(255, 255, 255, 0.3);
        }
        
        .sql-section {
            background: #2c3e50;
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
        }
        
        .sql-section h4 {
            margin-bottom: 15px;
            color: #ecf0f1;
        }
        
        .sql-query {
            background: #34495e;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
            white-space: pre-wrap;
        }
        
        .copy-button {
            background: #3498db;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
            font-size: 12px;
        }
        
        .stats-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }
        
        .export-section {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .export-button {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            margin: 0 10px;
            transition: all 0.3s ease;
        }
        
        .export-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.3);
        }
        
        @media (max-width: 768px) {
            .column-recommendations {
                grid-template-columns: 1fr;
            }
            
            .stats-section {
                grid-template-columns: 1fr;
            }
            
            .query-input {
                font-size: 16px;
                padding: 15px 50px 15px 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¤– CDP AI ìì—°ì–´ ì¿¼ë¦¬ í”Œë«í¼</h1>
            <p>ìì—°ì–´ë¡œ ì§ˆë¬¸í•˜ë©´ AIê°€ ìµœì ì˜ ê³ ê° ì„¸ê·¸ë¨¼í…Œì´ì…˜ ì „ëµì„ ì¶”ì²œí•©ë‹ˆë‹¤</p>
        </div>
        
        <div class="query-section">
            <div class="query-input-container">
                <input type="text" 
                       class="query-input" 
                       id="queryInput" 
                       placeholder="ì˜ˆ: ëŒ€ì¶œ ë‹ˆì¦ˆê°€ ë†’ì€ ê³ ê°êµ° ì•Œë ¤ì¤˜, ì Šì€ ì—¬ì„± ì¤‘ ë·°í‹° ê´€ì‹¬ì‚¬ê°€ ë†’ì€ ê³ ê° ì°¾ì•„ì¤˜"
                       onkeypress="handleKeyPress(event)">
                <button class="query-button" onclick="processQuery()">
                    ğŸ” ë¶„ì„
                </button>
            </div>
            
            <div class="query-examples">
                <div class="example-tag" onclick="setExampleQuery('ëŒ€ì¶œ ë‹ˆì¦ˆê°€ ë†’ì€ ê³ ê°êµ° ì•Œë ¤ì¤˜')">
                    ğŸ’° ëŒ€ì¶œ ë‹ˆì¦ˆ ê³ ê°
                </div>
                <div class="example-tag" onclick="setExampleQuery('20-30ëŒ€ ì—¬ì„± ì¤‘ ë·°í‹°ì— ê´€ì‹¬ì´ ë§ì€ ê³ ê°')">
                    ğŸ’„ ë·°í‹° ê´€ì‹¬ ì—¬ì„±
                </div>
                <div class="example-tag" onclick="setExampleQuery('ê³ ì†Œë“ì¸µ ì¤‘ íˆ¬ì ìƒí’ˆì— ê´€ì‹¬ìˆëŠ” ê³ ê°')">
                    ğŸ“ˆ íˆ¬ì ê´€ì‹¬ ê³ ê°
                </div>
                <div class="example-tag" onclick="setExampleQuery('í•´ì™¸ì—¬í–‰ì„ ìì£¼ ê°€ëŠ” ê³ ê° ì¤‘ ë³´í—˜ ê°€ì… ê°€ëŠ¥ì„±ì´ ë†’ì€ ì‚¬ëŒ')">
                    âœˆï¸ ì—¬í–‰ìë³´í—˜ ëŒ€ìƒ
                </div>
                <div class="example-tag" onclick="setExampleQuery('1ì¸ ê°€êµ¬ ì¤‘ ë°°ë‹¬ìŒì‹ì„ ìì£¼ ì‹œí‚¤ëŠ” ê³ ê°')">
                    ğŸ  1ì¸ê°€êµ¬ ë°°ë‹¬ì¡±
                </div>
                <div class="example-tag" onclick="setExampleQuery('ê³¨í”„ë¥¼ ì¹˜ëŠ” ê³ ê° ì¤‘ í”„ë¦¬ë¯¸ì—„ ì„œë¹„ìŠ¤ ì´ìš© ê°€ëŠ¥ì„±ì´ ë†’ì€ ì‚¬ëŒ')">
                    â›³ ê³¨í”„ VIP ê³ ê°
                </div>
            </div>
        </div>
        
        <div class="loading" id="loadingSection">
            <div class="spinner"></div>
            <p>ğŸ§  AIê°€ CDP ë°ì´í„°ë¥¼ ë¶„ì„í•˜ì—¬ ìµœì ì˜ ê³ ê° ì„¸ê·¸ë¨¼í…Œì´ì…˜ ì „ëµì„ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤...</p>
        </div>
        
        <div class="results-container" id="resultsContainer">
            <div id="analysisResults"></div>
        </div>
    </div>

    <script>
        const OPENAI_API_KEY = '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';
        
        // CDP ì»¬ëŸ¼ ì •ì˜
        const CDP_COLUMNS = {
            // ê´€ì‹¬ì‚¬ ê¸°ë°˜ ì§€í‘œ (fa_int_*)
            interests: {
                'fa_int_householdsingle': '1ì¸ ê°€êµ¬ ê´€ë ¨ ìƒí’ˆ ê²°ì œ',
                'fa_int_householdpet': 'ë°˜ë ¤ë™ë¬¼ ê´€ë ¨ ìƒí’ˆ ê²°ì œ',
                'fa_int_householdchild': 'ì–´ë¦°ì´ ê´€ë ¨ ìƒí’ˆ ê²°ì œ',
                'fa_int_householdbaby': 'ì˜ìœ ì•„ ê´€ë ¨ ìƒí’ˆ ê²°ì œ',
                'fa_int_loan1stfinancial': '1ê¸ˆìœµê¶Œ ì‹ ìš©ëŒ€ì¶œ ì‹¤í–‰',
                'fa_int_loan2ndfinancial': '2ê¸ˆìœµê¶Œ ì‹ ìš©ëŒ€ì¶œ ì‹¤í–‰',
                'fa_int_loanpersonal': 'ì‹ ìš©ëŒ€ì¶œ ì‹¤í–‰',
                'fa_int_saving': 'ì˜ˆì ê¸ˆ ê°œì„¤',
                'fa_int_homeappliance': 'ê°€ì „ ìƒí’ˆ ê²°ì œ',
                'fa_int_luxury': 'ëª…í’ˆ ê´€ë ¨ ê²°ì œ',
                'fa_int_delivery': 'ë°°ë‹¬ ê²°ì œ',
                'fa_int_carinsurance': 'ìë™ì°¨ ë³´í—˜ ê²°ì œ ì˜ˆì •',
                'fa_int_carpurchase': 'ì°¨ëŸ‰ êµ¬ë§¤',
                'fa_int_traveloverseas': 'í•´ì™¸ì—¬í–‰ ì˜ˆì •',
                'fa_int_traveldomestic': 'êµ­ë‚´ì—¬í–‰',
                'fa_int_golf': 'ê³¨í”„ ê´€ë ¨ ê²°ì œ',
                'fa_int_gym': 'í”¼íŠ¸ë‹ˆìŠ¤/í—¬ìŠ¤ì¥ ê²°ì œ',
                'fa_int_wedding': 'ê²°í˜¼ ì¤€ë¹„ ê´€ë ¨',
                'fa_int_highincome': 'ì¶”ì •ì†Œë“ 1ì–µ ì´ìƒ',
                'fa_int_homeowner': 'ì£¼íƒ ì†Œìœ ',
                'fa_int_business': 'ì‚¬ì—…ì',
                'fa_int_worker': 'ì •ê¸° ê¸‰ì—¬ ìˆ˜ë ¹'
            },
            
            // ì—…ì¢…ë³„ ì§€í‘œ (fa_ind_*)
            industries: {
                'fa_ind_finance': 'ê¸ˆìœµ ê²°ì œ',
                'fa_ind_insurance': 'ë³´í—˜ ê²°ì œ',
                'fa_ind_beauty': 'ë¯¸ìš© ê²°ì œ',
                'fa_ind_medical': 'ì˜ë£Œ ê²°ì œ',
                'fa_ind_travel': 'ì—¬í–‰ ê²°ì œ',
                'fa_ind_foodbeverage': 'F&B ê²°ì œ',
                'fa_ind_cafe': 'ì¹´í˜ ê²°ì œ',
                'fa_ind_restaurant': 'ìŒì‹ì  ê²°ì œ',
                'fa_ind_delivery': 'ë°°ë‹¬ ê²°ì œ',
                'fa_ind_cosmetic': 'ë·°í‹° ê²°ì œ',
                'fa_ind_fashion': 'íŒ¨ì…˜ì˜ë¥˜ ê²°ì œ',
                'fa_ind_digitalappliances': 'ë””ì§€í„¸ê°€ì „ ê²°ì œ',
                'fa_ind_education': 'êµìœ¡ ê²°ì œ',
                'fa_ind_golfcourse': 'ê³¨í”„ì¥ ê²°ì œ',
                'fa_ind_fitness': 'í”¼íŠ¸ë‹ˆìŠ¤ ê²°ì œ'
            },
            
            // ì˜ˆì¸¡ ìŠ¤ì½”ì–´ (sc_*)
            scores: {
                'sc_int_loan1stfinancial': '1ê¸ˆìœµê¶Œ ëŒ€ì¶œ ì˜ˆì¸¡ìŠ¤ì½”ì–´',
                'sc_int_loan2ndfinancial': '2ê¸ˆìœµê¶Œ ëŒ€ì¶œ ì˜ˆì¸¡ìŠ¤ì½”ì–´',
                'sc_int_luxury': 'ëª…í’ˆ êµ¬ë§¤ ì˜ˆì¸¡ìŠ¤ì½”ì–´',
                'sc_int_delivery': 'ë°°ë‹¬ ì´ìš© ì˜ˆì¸¡ìŠ¤ì½”ì–´',
                'sc_int_golf': 'ê³¨í”„ ê´€ë ¨ ì˜ˆì¸¡ìŠ¤ì½”ì–´',
                'sc_int_highincome': 'ê³ ì†Œë“ ì˜ˆì¸¡ìŠ¤ì½”ì–´',
                'sc_int_wedding': 'ê²°í˜¼ ì¤€ë¹„ ì˜ˆì¸¡ìŠ¤ì½”ì–´',
                'sc_ind_beauty': 'ë¯¸ìš© ì„œë¹„ìŠ¤ ì˜ˆì¸¡ìŠ¤ì½”ì–´',
                'sc_ind_cosmetic': 'ë·°í‹° ì œí’ˆ ì˜ˆì¸¡ìŠ¤ì½”ì–´',
                'sc_ind_finance': 'ê¸ˆìœµ ì„œë¹„ìŠ¤ ì˜ˆì¸¡ìŠ¤ì½”ì–´'
            },
            
            // í”Œë˜ê·¸ ì§€í‘œ (fi_npay_*)
            flags: {
                'fi_npay_age20': '20ëŒ€',
                'fi_npay_age30': '30ëŒ€',
                'fi_npay_age40': '40ëŒ€',
                'fi_npay_genderf': 'ì—¬ì„±',
                'fi_npay_genderm': 'ë‚¨ì„±',
                'fi_npay_membershipnormal': 'í”ŒëŸ¬ìŠ¤ë©¤ë²„ì‹­ ê°€ì…',
                'fi_npay_myassetreg': 'ë‚´ìì‚° ì„œë¹„ìŠ¤ ì—°ë™',
                'fi_npay_creditcheck': 'ì‹ ìš©ì¡°íšŒ ì„œë¹„ìŠ¤ ê°€ì…'
            }
        };
        
        // í‚¤ ì…ë ¥ ì²˜ë¦¬
        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                processQuery();
            }
        }
        
        // ì˜ˆì‹œ ì¿¼ë¦¬ ì„¤ì •
        function setExampleQuery(query) {
            document.getElementById('queryInput').value = query;
        }
        
        // ì¿¼ë¦¬ ì²˜ë¦¬ ë©”ì¸ í•¨ìˆ˜
        async function processQuery() {
            const query = document.getElementById('queryInput').value.trim();
            
            if (!query) {
                alert('ì§ˆë¬¸ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ë¡œë”© í‘œì‹œ
            document.getElementById('loadingSection').style.display = 'block';
            document.getElementById('resultsContainer').style.display = 'none';
            
            try {
                // OpenAI API í˜¸ì¶œ
                const result = await analyzeQueryWithAI(query);
                displayResults(result);
            } catch (error) {
                console.error('Error:', error);
                displayError('ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            } finally {
                document.getElementById('loadingSection').style.display = 'none';
                document.getElementById('resultsContainer').style.display = 'block';
            }
        }
        
        // OpenAI API í˜¸ì¶œ
        async function analyzeQueryWithAI(userQuery) {
            const prompt = createAnalysisPrompt(userQuery);
            
            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${OPENAI_API_KEY}`
                },
                body: JSON.stringify({
                    model: 'gpt-4',
                    messages: [
                        {
                            role: 'system',
                            content: `ë‹¹ì‹ ì€ CDP(Customer Data Platform) ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ì‚¬ìš©ìì˜ ìì—°ì–´ ì§ˆë¬¸ì„ ë¶„ì„í•˜ì—¬ ìµœì ì˜ ê³ ê° ì„¸ê·¸ë¨¼í…Œì´ì…˜ ì „ëµì„ ì œê³µí•©ë‹ˆë‹¤.
                            
                            ë‹¤ìŒ CDP ì»¬ëŸ¼ë“¤ì„ í™œìš©í•˜ì—¬ ë¶„ì„í•´ì£¼ì„¸ìš”:
                            ${JSON.stringify(CDP_COLUMNS, null, 2)}
                            
                            ì‘ë‹µì€ ë°˜ë“œì‹œ ë‹¤ìŒ JSON í˜•ì‹ìœ¼ë¡œ ì œê³µí•´ì£¼ì„¸ìš”:
                            {
                                "query_analysis": "ì‚¬ìš©ì ì§ˆë¬¸ ë¶„ì„ ë‚´ìš©",
                                "target_description": "íƒ€ê²Ÿ ê³ ê°êµ° ì„¤ëª…",
                                "recommended_columns": [
                                    {
                                        "column": "ì»¬ëŸ¼ëª…",
                                        "description": "ì»¬ëŸ¼ ì„¤ëª…",
                                        "condition": "ì¶”ì²œ ì¡°ê±´ (ì˜ˆ: > 0.7, IS NOT NULL ë“±)",
                                        "priority": "high|medium|low",
                                        "reasoning": "ì„ íƒ ì´ìœ "
                                    }
                                ],
                                "sql_query": "SELECT ë¬¸ìœ¼ë¡œ ëœ ì¿¼ë¦¬",
                                "business_insights": [
                                    "ë¹„ì¦ˆë‹ˆìŠ¤ ì¸ì‚¬ì´íŠ¸ 1",
                                    "ë¹„ì¦ˆë‹ˆìŠ¤ ì¸ì‚¬ì´íŠ¸ 2"
                                ],
                                "estimated_target_size": "ì˜ˆìƒ íƒ€ê²Ÿ ê·œëª¨ (%)",
                                "marketing_recommendations": [
                                    "ë§ˆì¼€íŒ… ì¶”ì²œì‚¬í•­ 1",
                                    "ë§ˆì¼€íŒ… ì¶”ì²œì‚¬í•­ 2"
                                ]
                            }`
                        },
                        {
                            role: 'user',
                            content: userQuery
                        }
                    ],
                    temperature: 0.7,
                    max_tokens: 2000
                })
            });
            
            if (!response.ok) {
                throw new Error(`OpenAI API Error: ${response.status}`);
            }
            
            const data = await response.json();
            const aiResponse = data.choices[0].message.content;
            
            try {
                return JSON.parse(aiResponse);
            } catch (parseError) {
                // JSON íŒŒì‹± ì‹¤íŒ¨ ì‹œ ë”ë¯¸ ë°ì´í„° ë°˜í™˜
                return generateFallbackResult(userQuery);
            }
        }
        
        // ë¶„ì„ í”„ë¡¬í”„íŠ¸ ìƒì„±
        function createAnalysisPrompt(query) {
            return `
ì‚¬ìš©ì ì§ˆë¬¸: "${query}"

ìœ„ ì§ˆë¬¸ì„ ë¶„ì„í•˜ì—¬ ë‹¤ìŒì„ ì œê³µí•´ì£¼ì„¸ìš”:

1. ì§ˆë¬¸ì˜ í•µì‹¬ ìš”êµ¬ì‚¬í•­ ë¶„ì„
2. íƒ€ê²Ÿ ê³ ê°êµ°ì„ ì •ì˜í•˜ê¸° ìœ„í•œ ìµœì ì˜ CDP ì»¬ëŸ¼ ì¡°í•© ì¶”ì²œ
3. ê° ì»¬ëŸ¼ì„ ì„ íƒí•œ ì´ìœ ì™€ ì¶”ì²œ ì¡°ê±´ê°’
4. ì‹¤í–‰ ê°€ëŠ¥í•œ SQL ì¿¼ë¦¬
5. ë¹„ì¦ˆë‹ˆìŠ¤ ì¸ì‚¬ì´íŠ¸ ë° ë§ˆì¼€íŒ… í™œìš© ë°©ì•ˆ

CDP ë°ì´í„°ì˜ íŠ¹ì„±:
- fa_int_*: ê´€ì‹¬ì‚¬ ê¸°ë°˜ í–‰ë™ ì§€í‘œ (date íƒ€ì…, ì´ë²¤íŠ¸ ë°œìƒì¼)
- fa_ind_*: ì—…ì¢…ë³„ ê²°ì œ ì§€í‘œ (date íƒ€ì…, ê²°ì œì¼)
- sc_*: AI ì˜ˆì¸¡ ìŠ¤ì½”ì–´ (0-1 ë²”ìœ„ì˜ double íƒ€ì…)
- fi_npay_*: í”Œë˜ê·¸ ì§€í‘œ (boolean íƒ€ì…)
            `;
        }
        
        // í´ë°± ê²°ê³¼ ìƒì„± (API ì‹¤íŒ¨ ì‹œ)
        function generateFallbackResult(query) {
            const loanKeywords = ['ëŒ€ì¶œ', 'ë¹Œë ¤', 'ì‹ ìš©', 'ê¸ˆìœµ', 'ëˆ'];
            const beautyKeywords = ['ë·°í‹°', 'í™”ì¥í’ˆ', 'ë¯¸ìš©', 'ì½”ìŠ¤ë©”í‹±'];
            const travelKeywords = ['ì—¬í–‰', 'í•´ì™¸', 'í•­ê³µ', 'í˜¸í…”'];
            
            let targetType = 'ì¼ë°˜';
            if (loanKeywords.some(keyword => query.includes(keyword))) {
                targetType = 'ëŒ€ì¶œ';
            } else if (beautyKeywords.some(keyword => query.includes(keyword))) {
                targetType = 'ë·°í‹°';
            } else if (travelKeywords.some(keyword => query.includes(keyword))) {
                targetType = 'ì—¬í–‰';
            }
            
            return generateTargetRecommendation(targetType, query);
        }
        
        // íƒ€ê²Ÿë³„ ì¶”ì²œ ìƒì„±
        function generateTargetRecommendation(targetType, originalQuery) {
            const recommendations = {
                'ëŒ€ì¶œ': {
                    query_analysis: 'ì‚¬ìš©ìê°€ ëŒ€ì¶œ ë‹ˆì¦ˆê°€ ë†’ì€ ê³ ê°êµ°ì„ ìš”ì²­í–ˆìŠµë‹ˆë‹¤.',
                    target_description: 'ëŒ€ì¶œ ìƒí’ˆì— ê´€ì‹¬ì´ ë†’ê³  ì‹ ì²­ ê°€ëŠ¥ì„±ì´ ë†’ì€ ê³ ê°êµ°',
                    recommended_columns: [
                        {
                            column: 'sc_int_loan1stfinancial',
                            description: '1ê¸ˆìœµê¶Œ ì‹ ìš©ëŒ€ì¶œ ì˜ˆì¸¡ìŠ¤ì½”ì–´',
                            condition: '> 0.7',
                            priority: 'high',
                            reasoning: '1ê¸ˆìœµê¶Œ ëŒ€ì¶œ ì‹ ì²­ ê°€ëŠ¥ì„±ì´ ë†’ì€ ê³ ê°ì„ ìš°ì„  íƒ€ê²ŸíŒ…'
                        },
                        {
                            column: 'fa_int_loanpersonal',
                            description: 'ìµœê·¼ ì‹ ìš©ëŒ€ì¶œ ì‹¤í–‰ ì´ë ¥',
                            condition: 'IS NOT NULL',
                            priority: 'high',
                            reasoning: 'ê¸°ì¡´ ëŒ€ì¶œ ê²½í—˜ì´ ìˆì–´ ì¶”ê°€ ëŒ€ì¶œ ë‹ˆì¦ˆê°€ ìˆì„ ê°€ëŠ¥ì„±'
                        },
                        {
                            column: 'fi_npay_creditcheck',
                            description: 'ì‹ ìš©ì¡°íšŒ ì„œë¹„ìŠ¤ ê°€ì…',
                            condition: '= true',
                            priority: 'medium',
                            reasoning: 'ì‹ ìš© ê´€ë¦¬ì— ê´€ì‹¬ì´ ë†’ì•„ ëŒ€ì¶œ ìƒí’ˆì—ë„ ê´€ì‹¬ì´ ìˆì„ ê²ƒ'
                        },
                        {
                            column: 'sc_int_highincome',
                            description: 'ê³ ì†Œë“ ì˜ˆì¸¡ìŠ¤ì½”ì–´',
                            condition: '> 0.6',
                            priority: 'medium',
                            reasoning: 'ì•ˆì •ì  ì†Œë“ìœ¼ë¡œ ëŒ€ì¶œ ìƒí™˜ ëŠ¥ë ¥ì´ ê²€ì¦ëœ ê³ ê°'
                        }
                    ],
                    sql_query: `SELECT mbr_id_no, 
       sc_int_loan1stfinancial,
       fa_int_loanpersonal,
       fi_npay_creditcheck,
       sc_int_highincome
FROM cdp_customer_data 
WHERE sc_int_loan1stfinancial > 0.7 
   OR (fa_int_loanpersonal IS NOT NULL AND fi_npay_creditcheck = true)
   OR (sc_int_highincome > 0.6 AND fi_npay_creditcheck = true)
ORDER BY sc_int_loan1stfinancial DESC;`,
                    business_insights: [
                        'ê³ ì†Œë“ì¸µì¼ìˆ˜ë¡ ëŒ€ì¶œ í•œë„ê°€ ë†’ì•„ ìˆ˜ìµì„±ì´ ì¢‹ìŠµë‹ˆë‹¤',
                        'ê¸°ì¡´ ëŒ€ì¶œ ê³ ê°ì˜ ëŒ€í™˜ëŒ€ì¶œ ë‹ˆì¦ˆë¥¼ ì ê·¹ í™œìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤',
                        'ì‹ ìš©ì¡°íšŒ ì„œë¹„ìŠ¤ ì´ìš©ìëŠ” ê¸ˆìœµ ìƒí’ˆì— ëŒ€í•œ ê´€ì‹¬ë„ê°€ ë†’ìŠµë‹ˆë‹¤'
                    ],
                    estimated_target_size: '15-20%',
                    marketing_recommendations: [
                        'ë§ì¶¤í˜• ëŒ€ì¶œ ìƒí’ˆ ì¶”ì²œ ë©”ì‹œì§€ ë°œì†¡',
                        'ì‹ ìš©ì ìˆ˜ ê¸°ë°˜ ìš°ëŒ€ê¸ˆë¦¬ ì œì•ˆ',
                        'ê¸°ì¡´ ëŒ€ì¶œ ê³ ê° ëŒ€ìƒ ëŒ€í™˜ëŒ€ì¶œ ìƒë‹´ ì œì•ˆ',
                        'ì‹ ìš©ì¡°íšŒ ì„œë¹„ìŠ¤ì™€ ì—°ê³„í•œ ëŒ€ì¶œ ìƒí’ˆ ì•ˆë‚´'
                    ]
                },
                'ë·°í‹°': {
                    query_analysis: 'ë·°í‹°/í™”ì¥í’ˆì— ê´€ì‹¬ì´ ë†’ì€ ê³ ê°êµ°ì„ ìš”ì²­í–ˆìŠµë‹ˆë‹¤.',
                    target_description: 'ë·°í‹° ë° í™”ì¥í’ˆ êµ¬ë§¤ í™œë™ì´ í™œë°œí•œ ê³ ê°êµ°',
                    recommended_columns: [
                        {
                            column: 'sc_ind_cosmetic',
                            description: 'ë·°í‹° ì œí’ˆ ê²°ì œ ì˜ˆì¸¡ìŠ¤ì½”ì–´',
                            condition: '> 0.8',
                            priority: 'high',
                            reasoning: 'ë·°í‹° ì œí’ˆ êµ¬ë§¤ ê°€ëŠ¥ì„±ì´ ë§¤ìš° ë†’ì€ í•µì‹¬ íƒ€ê²Ÿ'
                        },
                        {
                            column: 'fa_ind_beauty',
                            description: 'ë¯¸ìš© ì„œë¹„ìŠ¤ ê²°ì œ ì´ë ¥',
                            condition: 'IS NOT NULL',
                            priority: 'high',
                            reasoning: 'ë¯¸ìš©ì‹¤, ë„¤ì¼ìƒµ ë“± ë·°í‹° ì„œë¹„ìŠ¤ ì´ìš©ìœ¼ë¡œ ê´€ì‹¬ë„ í™•ì¸'
                        },
                        {
                            column: 'fi_npay_genderf',
                            description: 'ì—¬ì„± ê³ ê°',
                            condition: '= true',
                            priority: 'medium',
                            reasoning: 'ë·°í‹° ì œí’ˆì˜ ì£¼ìš” íƒ€ê²Ÿì¸µì¸ ì—¬ì„± ê³ ê°'
                        },
                        {
                            column: 'fi_npay_age20',
                            description: '20ëŒ€ ì—°ë ¹ì¸µ',
                            condition: '= true',
                            priority: 'medium',
                            reasoning: 'ë·°í‹° íŠ¸ë Œë“œì— ë¯¼ê°í•œ ì Šì€ ì—°ë ¹ì¸µ'
                        }
                    ],
                    sql_query: `SELECT mbr_id_no,
       sc_ind_cosmetic,
       fa_ind_beauty,
       fi_npay_genderf,
       fi_npay_age20
FROM cdp_customer_data
WHERE sc_ind_cosmetic > 0.8
   OR (fa_ind_beauty IS NOT NULL AND fi_npay_genderf = true)
   OR (fi_npay_genderf = true AND fi_npay_age20 = true AND sc_ind_cosmetic > 0.5)
ORDER BY sc_ind_cosmetic DESC;`,
                    business_insights: [
                        'ì Šì€ ì—¬ì„±ì¸µì˜ ë·°í‹° ì§€ì¶œì´ ì§€ì†ì ìœ¼ë¡œ ì¦ê°€í•˜ê³  ìˆìŠµë‹ˆë‹¤',
                        'ë¯¸ìš© ì„œë¹„ìŠ¤ì™€ ë·°í‹° ì œí’ˆì„ í•¨ê»˜ ì´ìš©í•˜ëŠ” ê³ ê°ì˜ LTVê°€ ë†’ìŠµë‹ˆë‹¤',
                        'ì˜¨ë¼ì¸ ë·°í‹° ì»¤ë¨¸ìŠ¤ ì‹œì¥ì´ ë¹ ë¥´ê²Œ ì„±ì¥í•˜ê³  ìˆìŠµë‹ˆë‹¤'
                    ],
                    estimated_target_size: '25-30%',
                    marketing_recommendations: [
                        'ë·°í‹° ì¸í”Œë£¨ì–¸ì„œì™€ í˜‘ì—…í•œ ì œí’ˆ ì¶”ì²œ',
                        'ê°œì¸ ë§ì¶¤í˜• ë·°í‹° ë£¨í‹´ ì œì•ˆ',
                        'ë¯¸ìš©ì‹¤ ì—°ê³„ ì œí’ˆ í• ì¸ ì¿ í° ì œê³µ',
                        'ë·°í‹° íŠ¸ë Œë“œ ì •ë³´ì™€ í•¨ê»˜í•˜ëŠ” ì œí’ˆ ê´‘ê³ '
                    ]
                },
                'ì—¬í–‰': {
                    query_analysis: 'ì—¬í–‰ ê´€ë ¨ ìƒí’ˆ/ì„œë¹„ìŠ¤ì— ê´€ì‹¬ì´ ë†’ì€ ê³ ê°êµ°ì„ ìš”ì²­í–ˆìŠµë‹ˆë‹¤.',
                    target_description: 'ì—¬í–‰ì„ ìì£¼ ë‹¤ë‹ˆë©° ì—¬í–‰ ê´€ë ¨ ì§€ì¶œì´ í™œë°œí•œ ê³ ê°êµ°',
                    recommended_columns: [
                        {
                            column: 'fa_int_traveloverseas',
                            description: 'í•´ì™¸ì—¬í–‰ ì˜ˆì • ê³ ê°',
                            condition: 'IS NOT NULL',
                            priority: 'high',
                            reasoning: 'í•´ì™¸ì—¬í–‰ ê³„íšì´ ìˆì–´ ì—¬í–‰ ìƒí’ˆ êµ¬ë§¤ ê°€ëŠ¥ì„±ì´ ë†’ìŒ'
                        },
                        {
                            column: 'fa_ind_travel',
                            description: 'ì—¬í–‰ ê´€ë ¨ ê²°ì œ ì´ë ¥',
                            condition: 'IS NOT NULL',
                            priority: 'high',
                            reasoning: 'ì—¬í–‰ì‚¬, í•­ê³µê¶Œ ë“± ì—¬í–‰ ìƒí’ˆ êµ¬ë§¤ ê²½í—˜ì´ ìˆìŒ'
                        },
                        {
                            column: 'fa_ind_airsevice',
                            description: 'í•­ê³µ ì„œë¹„ìŠ¤ ì´ìš©',
                            condition: 'IS NOT NULL',
                            priority: 'medium',
                            reasoning: 'í•­ê³µí¸ ì´ìš©ìœ¼ë¡œ ì¤‘ì¥ê±°ë¦¬ ì—¬í–‰ ì„ í˜¸ë„ í™•ì¸'
                        },
                        {
                            column: 'sc_int_highincome',
                            description: 'ê³ ì†Œë“ ì˜ˆì¸¡ìŠ¤ì½”ì–´',
                            condition: '> 0.6',
                            priority: 'medium',
                            reasoning: 'ì—¬í–‰ì— ì¶©ë¶„í•œ ì§€ì¶œì´ ê°€ëŠ¥í•œ ê²½ì œë ¥ ë³´ìœ '
                        }
                    ],
                    sql_query: `SELECT mbr_id_no,
       fa_int_traveloverseas,
       fa_ind_travel,
       fa_ind_airsevice,
       sc_int_highincome
FROM cdp_customer_data
WHERE fa_int_traveloverseas IS NOT NULL
   OR (fa_ind_travel IS NOT NULL AND sc_int_highincome > 0.6)
   OR (fa_ind_airsevice IS NOT NULL AND fa_ind_travel IS NOT NULL)
ORDER BY sc_int_highincome DESC;`,
                    business_insights: [
                        'í•´ì™¸ì—¬í–‰ ìˆ˜ìš”ê°€ ì½”ë¡œë‚˜19 ì´í›„ ê¸‰ê²©íˆ íšŒë³µë˜ê³  ìˆìŠµë‹ˆë‹¤',
                        'ê³ ì†Œë“ì¸µì¼ìˆ˜ë¡ í”„ë¦¬ë¯¸ì—„ ì—¬í–‰ ìƒí’ˆì„ ì„ í˜¸í•©ë‹ˆë‹¤',
                        'ì—¬í–‰ìë³´í—˜, í™˜ì „ ë“± ë¶€ê°€ ì„œë¹„ìŠ¤ ìˆ˜ìš”ë„ í•¨ê»˜ ì¦ê°€í•©ë‹ˆë‹¤'
                    ],
                    estimated_target_size: '12-18%',
                    marketing_recommendations: [
                        'ì‹œì¦Œë³„ ì—¬í–‰ íŒ¨í‚¤ì§€ ìƒí’ˆ ì¶”ì²œ',
                        'ì—¬í–‰ìë³´í—˜ ìƒí’ˆê³¼ ì—°ê³„ ë§ˆì¼€íŒ…',
                        'í•­ê³µë§ˆì¼ë¦¬ì§€ ì ë¦½ í˜œíƒ ê°•í™”',
                        'ì—¬í–‰ ê´€ë ¨ ê¸ˆìœµ ìƒí’ˆ(ì—¬í–‰ì ê¸ˆ, í™˜ì „) ì œì•ˆ'
                    ]
                }
            };
            
            return recommendations[targetType] || recommendations['ì¼ë°˜'] || {
                query_analysis: originalQuery + 'ì— ëŒ€í•œ ë¶„ì„ì„ ìˆ˜í–‰í–ˆìŠµë‹ˆë‹¤.',
                target_description: 'ìš”ì²­í•˜ì‹  ì¡°ê±´ì— ë§ëŠ” ê³ ê°êµ°',
                recommended_columns: [],
                sql_query: 'SELECT * FROM cdp_customer_data LIMIT 100;',
                business_insights: ['ì¶”ê°€ ë¶„ì„ì´ í•„ìš”í•©ë‹ˆë‹¤.'],
                estimated_target_size: '10-15%',
                marketing_recommendations: ['ë§ì¶¤í˜• ë§ˆì¼€íŒ… ì „ëµì„ ìˆ˜ë¦½í•´ë³´ì„¸ìš”.']
            };
        }
        
        // ê²°ê³¼ í‘œì‹œ
        function displayResults(result) {
            const resultsDiv = document.getElementById('analysisResults');
            
            resultsDiv.innerHTML = `
                <div class="analysis-result">
                    <div class="analysis-title">ì§ˆë¬¸ ë¶„ì„ ê²°ê³¼</div>
                    <p>${result.query_analysis}</p>
                </div>
                
                <div class="analysis-result">
                    <div class="analysis-title">íƒ€ê²Ÿ ê³ ê°êµ° ì •ì˜</div>
                    <p>${result.target_description}</p>
                </div>
                
                <div class="stats-section">
                    <div class="stat-card">
                        <div class="stat-number">${result.recommended_columns.length}</div>
                        <div class="stat-label">ì¶”ì²œ ì»¬ëŸ¼ ìˆ˜</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${result.estimated_target_size}</div>
                        <div class="stat-label">ì˜ˆìƒ íƒ€ê²Ÿ ê·œëª¨</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${result.marketing_recommendations.length}</div>
                        <div class="stat-label">ë§ˆì¼€íŒ… ì œì•ˆ</div>
                    </div>
                </div>
                
                <div class="analysis-result">
                    <div class="analysis-title">ì¶”ì²œ CDP ì»¬ëŸ¼ ì¡°í•©</div>
                    <div class="column-recommendations">
                        ${generateColumnRecommendations(result.recommended_columns)}
                    </div>
                </div>
                
                <div class="reasoning-section">
                    <h4>ğŸ§  AI ë¶„ì„ ê·¼ê±°</h4>
                    ${result.recommended_columns.map(col => `
                        <div class="reasoning-item">
                            <strong>${col.column}:</strong> ${col.reasoning}
                        </div>
                    `).join('')}
                </div>
                
                <div class="sql-section">
                    <h4>ğŸ“ ì‹¤í–‰ ê°€ëŠ¥í•œ SQL ì¿¼ë¦¬</h4>
                    <div class="sql-query">${result.sql_query}</div>
                    <button class="copy-button" onclick="copyToClipboard('${result.sql_query.replace(/'/g, "\\'")}')">
                        ğŸ“‹ ì¿¼ë¦¬ ë³µì‚¬
                    </button>
                </div>
                
                <div class="analysis-result">
                    <div class="analysis-title">ë¹„ì¦ˆë‹ˆìŠ¤ ì¸ì‚¬ì´íŠ¸</div>
                    ${result.business_insights.map(insight => `<p>â€¢ ${insight}</p>`).join('')}
                </div>
                
                <div class="analysis-result">
                    <div class="analysis-title">ë§ˆì¼€íŒ… í™œìš© ë°©ì•ˆ</div>
                    ${result.marketing_recommendations.map(rec => `<p>â€¢ ${rec}</p>`).join('')}
                </div>
                
                <div class="export-section">
                    <h4>ğŸ“Š ê²°ê³¼ ë‚´ë³´ë‚´ê¸°</h4>
                    <button class="export-button" onclick="exportToCSV()">CSV ë‹¤ìš´ë¡œë“œ</button>
                    <button class="export-button" onclick="exportToPDF()">PDF ë¦¬í¬íŠ¸</button>
                    <button class="export-button" onclick="shareResults()">ê²°ê³¼ ê³µìœ </button>
                </div>
            `;
        }
        
        // ì»¬ëŸ¼ ì¶”ì²œ HTML ìƒì„±
        function generateColumnRecommendations(columns) {
            const grouped = {
                high: columns.filter(c => c.priority === 'high'),
                medium: columns.filter(c => c.priority === 'medium'),
                low: columns.filter(c => c.priority === 'low')
            };
            
            return Object.entries(grouped).map(([priority, cols]) => {
                if (cols.length === 0) return '';
                
                const priorityLabels = {
                    high: 'ğŸ”¥ í•µì‹¬ ì§€í‘œ',
                    medium: 'â­ ë³´ì¡° ì§€í‘œ',
                    low: 'ğŸ’¡ ì°¸ê³  ì§€í‘œ'
                };
                
                return `
                    <div class="column-group">
                        <h4>${priorityLabels[priority]}</h4>
                        ${cols.map(col => `
                            <div class="column-item">
                                <div>
                                    <div class="column-name">${col.column}</div>
                                    <div style="font-size: 0.9em; color: #6c757d; margin-top: 2px;">
                                        ${col.description}
                                    </div>
                                    <div style="font-size: 0.8em; color: #4CAF50; margin-top: 2px;">
                                        ì¡°ê±´: ${col.condition}
                                    </div>
                                </div>
                                <div class="column-score">${priority.toUpperCase()}</div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }).join('');
        }
        
        // ì—ëŸ¬ í‘œì‹œ
        function displayError(message) {
            const resultsDiv = document.getElementById('analysisResults');
            resultsDiv.innerHTML = `
                <div class="analysis-result" style="border-left-color: #dc3545;">
                    <div class="analysis-title" style="color: #dc3545;">âš ï¸ ì˜¤ë¥˜ ë°œìƒ</div>
                    <p>${message}</p>
                    <p>ë‹¤ì‹œ ì‹œë„í•˜ì‹œê±°ë‚˜ ë‹¤ë¥¸ ì§ˆë¬¸ìœ¼ë¡œ ë¬¼ì–´ë³´ì„¸ìš”.</p>
                </div>
            `;
        }
        
        // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert('ì¿¼ë¦¬ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
            });
        }
        
        function exportToCSV() {
            alert('CSV ë‚´ë³´ë‚´ê¸° ê¸°ëŠ¥ì´ ê³§ ì œê³µë  ì˜ˆì •ì…ë‹ˆë‹¤.');
        }
        
        function exportToPDF() {
            alert('PDF ë¦¬í¬íŠ¸ ê¸°ëŠ¥ì´ ê³§ ì œê³µë  ì˜ˆì •ì…ë‹ˆë‹¤.');
        }
        
        function shareResults() {
            alert('ê²°ê³¼ ê³µìœ  ê¸°ëŠ¥ì´ ê³§ ì œê³µë  ì˜ˆì •ì…ë‹ˆë‹¤.');
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            console.log('CDP AI ìì—°ì–´ ì¿¼ë¦¬ í”Œë«í¼ì´ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');
            
            // ì²« ë²ˆì§¸ ì˜ˆì‹œ ì§ˆë¬¸ì„ ë¯¸ë¦¬ ì„¤ì •
            document.getElementById('queryInput').focus();
        });
    </script>
</body>
</html>